(window.siqcwJsonp=window.siqcwJsonp||[]).push([["ConversationHome"],{"0c05":function(t,e,i){},"4d33":function(t,e,i){"use strict";i("0c05")},5566:function(t,e,i){"use strict";i.r(e);var a=i("2f62"),o=i("8db4"),n=(i("05a0"),(()=>{const t={cw:()=>Promise.all([i.e("AttachmentPreview~CallBodyWrapper~ChatInitiator~ChatWindow~TraditionalForm"),i.e("ChatWindow~TraditionalForm"),i.e("ChatWindow")]).then(i.bind(null,"4d14")),form:()=>Promise.all([i.e("AttachmentPreview~CallBodyWrapper~ChatInitiator~ChatWindow~TraditionalForm"),i.e("ChatWindow~TraditionalForm"),i.e("TraditionalForm")]).then(i.bind(null,"1000")),list:()=>i.e("ChatList").then(i.bind(null,"f551")),inlineform:()=>Promise.all([i.e("AttachmentPreview~CallBodyWrapper~ChatInitiator~ChatWindow~TraditionalForm"),i.e("ChatInitiator")]).then(i.bind(null,"9b56"))};return{data:()=>({isChatWindowOpen:!1,hasConversationList:!1,isLoading:!1}),provide(){return{patchCurrentNavigation:this.patchCurrentNavigation,handleBack:this.handleBack,closeForm:this.closeForm}},inject:["chatConfig","embedDetail","viewConversations"],computed:{...Object(a.c)("conversationstore",["activeChatId","conversationList","showForm","showCallForm"]),...Object(a.c)("mediastore",["activeCall","viewingCall"]),...Object(a.c)("embedstore",["embedDetail","visitorInfo"]),...Object(a.b)("conversationstore",["activeChatIds","hasOngoingChats","ongoingCallDetail"]),...Object(a.b)("embedstore",["embedStatus","isDirectCallEnabled","callOnlyEnabled","isTraditionalForm","isChatEnabled","allowParallelChats"]),activeComponent(){switch(!0){case this.isChatWindowOpen:return t.cw;case this.showForm:return this.isTraditionalForm||this.showCallForm?t.form:t.inlineform;default:return t.list}},componentProps(){let{isChatWindowOpen:t}=this;return t||this.showForm?t?{chatId:this.activeChatId}:this.showForm&&this.showCallForm?{isCallForm:this.showCallForm}:void 0:this.isDirectCallEnabled?{startCall:this.openCallForm,startChat:this.checkAndStartChat,isLoading:this.isLoading}:{toggleDrivenLogo:this.toggleDrivenBy,startChat:this.checkAndStartChat}},isConvListShown(){return!this.showForm},headerIcon(){return this.isConvListShown?"":this.callOnlyEnabled?"siqico-call ifont24":"siqico-clogo siq-clogo"}},beforeMount(){this.$eventBus.$on("onlineStatusChange",this.handleOnlineStatusChange),this.$eventBus.$on("handleBack",this.handleBack),this.$eventBus.$on("patchCurrentNavigation",this.patchCurrentNavigation)},mounted(){this.$eventBus.$emit("conversationLoaded",this),this.$eventBus.$on("toggleLoading",(t=>{this.isLoading=t}))},methods:{openConversationForm(t){this.updateFormState(!0,t),this.updateNavState()},checkAndStartChat(){this.embedDetail.dynamicConf.isTriggerOnChatnowEnabled&&Object(o.a)()?this.handleTriggerOnStartChat():this.openConversationForm()},handleTriggerOnStartChat(){this.isLoading=!0,this.visitorInfo.uvid?Object(o.X)().then(this.handleTriggerChat).finally((()=>{this.isLoading=!1})):Object(o.rb)((()=>{this.openConversationForm(),this.isLoading=!1}))},handleTriggerChat(t){let e=t.triggers;16!==(e&&JSON.parse(e.type))?this.openConversationForm():Object(o.Y)(e)},openCallForm(){this.openConversationForm(!0)},updateFormState(t,e){this.$store.commit("conversationstore/updateFormState",{showForm:t,showCallForm:e})},closeForm(){this.updateFormState(!1,!1)},getHeaderTitle(){if(this.isConvListShown){let t=this.callOnlyEnabled?"call.withus":"siq.conv";return this.$doI18N(t)}return this.prevChatDetail.attenderName||Object(o.F)(this.showCallForm)},handleBack(){this.closeForm(),this.clearPrevChatDetail(),Object(o.lb)(""),this.updateNavState()},getLogoSrc(){if(this.isConvListShown)return"";let{prevChatDetail:t}=this;return t.attenderId?t.attenderDp:Object(o.x)()},getCustomIcon(){var t;if(this.showForm||this.activeChatId||this.ongoingCallDetail.chid)return;let e=null===(t=this.activeChatIds)||void 0===t?void 0:t.length,i=!!(this.activeChatId||!e||e&&this.allowParallelChats);return this.isChatEnabled&&this.isDirectCallEnabled&&i?{class:"siqico-call siqcw-audio",title:this.$doI18N("siqcw.makecall"),direction:"left-middle",clickHandler:this.openCallForm}:void 0},updateNavState(){let{prevChatDetail:t}=this,e={title:this.getHeaderTitle(),imgSrc:this.getLogoSrc(),iconClass:(t=>t?t+" clr6":"")(t.attenderIcon||this.headerIcon),desc:t.attenderDesc,customIcon:this.getCustomIcon()},i=[e];this.pushNavStates(this.showForm||this.activeChatId?i.concat([{...e,onBack:this.handleBack}]):i)},pushNavStates(t){this.currentNavigation=t.slice(-1)[0],this.pushNavigationState(t,!0)},patchCurrentNavigation(t){Object.keys(t).forEach((e=>{this.$set(this.currentNavigation,e,t[e])}))},handleActiveChatChange(t){this.isChatWindowOpen=!!t,t&&!this.showForm&&(this.clearPrevChatDetail(),this.closeForm()),this.updateNavState()},isListShown(){return this.activeComponent===t.list},handleOnlineStatusChange(t){if(this.showForm)return this.patchCurrentNavigation({title:this.getHeaderTitle()});t?this.openCallForm():this.openConversationForm()}},watch:{activeChatId:{immediate:!0,handler:"handleActiveChatChange"},"ongoingCallDetail.chid"(){this.patchCurrentNavigation({customIcon:this.getCustomIcon()})}},beforeDestroy(){this.$eventBus.$off("onlineStatusChange",this.handleOnlineStatusChange),this.$eventBus.$off("handleBack",this.handleBack),this.$eventBus.$off("patchCurrentNavigation",this.patchCurrentNavigation),this.$eventBus.$off("toggleLoading")}}})()),s={data:()=>({prevChatDetail:{}}),provide(){return{handleBroadcastChat:this.handleBroadcastChat,getPrevChatDetail:()=>this.prevChatDetail,clearPrevChatDetail:this.clearPrevChatDetail}},methods:{handleBroadcastChat(t){Object(o.lb)(""),this.prevChatDetail=t,this.openConversationForm()},clearPrevChatDetail(){this.prevChatDetail={}}}},h={name:"ConversationHome",mixins:[n,s],inject:["pushNavigationState"],computed:{...Object(a.c)("embedstore",["visitorInfo"])},created(){this.updateNavState()},beforeMount(){this.$eventBus.$emit("msgNotification","")}},r=(i("4d33"),i("2877")),l=Object(r.a)(h,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("AsyncComponent",{attrs:{comp:t.activeComponent,compProps:t.componentProps}})}),[],!1,null,null,null);e.default=l.exports}}]);